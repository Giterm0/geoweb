<html>

<head>
    <meta charset='utf-8' />
    <title>Visor VIS Quito</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css" />
    <style>
        body {
            margin: 0;
            padding: 0;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            height: 100%
        }
    </style>

        <!-- DISEÑO DE LOS BOTONES -->
    <style>
        #menu {
            background: #fff;
            position: absolute;
            z-index: 1;
            top: 10px;
            left: 10px;
            border-radius: 3px;
            width: 120px;
            border: 1px solid rgba(0, 0, 0, 0.4);
            font-family: 'Open Sans', sans-serif;
        }
        
        #menu a {
            font-size: 13px;
            color: #404040;
            display: block;
            margin: 0;
            padding: 0;
            padding: 10px;
            text-decoration: none;
            border-bottom: 1px solid rgba(0, 0, 0, 0.25);
            text-align: center;
        }
        
        #menu a:last-child {
            border: none;
        }
        
        #menu a:hover {
            background-color: #f8f8f8;
            color: #404040;
        }
        
        #menu a.active {
            background-color: #3887be;
            color: #ffffff;
        }
        
        #menu a.active:hover {
            background: #3074a4;
        }
    </style>
     
    <nav id="menu"></nav>
   

    <script>
        function init() {
            mapboxgl.accessToken =
                'pk.eyJ1IjoibWFwZ3VpMTEzIiwiYSI6ImNreWJxMzFjeDA5MXAyd3F2dGt4cGF3emUifQ.8udZrNyXjXZ74xnPtPL_og';
            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapgui113/cle3erb1c001q01jtbndpfppb',
                center: [-78.50025, -0.19939],
                zoom: 11,
                attributionControl: false,
                hash: true
            });

            map.addControl(new mapboxgl.AttributionControl({
                compact: true
            }));
            map.addControl(new mapboxgl.NavigationControl());
            map.addControl(new mapboxgl.GeolocateControl({
                positionOptions: {
                    enableHighAccuracy: true
                },
                trackUserLocation: true
            }));

            // AQUÍ SE CARGA LA CAPA DE USOS DE SUELO AL VISOR
            map.on('load', function () {
                map.addSource("Usos-de-suelo-residencial-y-multiple_source", {
                    type: "vector",
                    url: "mapbox://mapgui113.bkcy0vhp" //URL DE LA CAPA AL CARGAR EN MAPBOX STUDIO 
                });

                map.addLayer({
                    id: "Usos-de-suelo-residencial-y-multiple",
                    type: "fill",
                    source: "Usos-de-suelo-residencial-y-multiple_source",
                    'source-layer': "Usos_de_suelo_residencial_y_m-avggwx", //NOMBRE DE LA CAPA AL CARGAR EN MAPBOX STUDIO
                    paint: {'fill-color': "#feff73", 'fill-opacity': 0.50}
                     
                });
            });

            // AQUÍ SE CARGA LA CAPA COMPACIDAD ABSOLUTA AL VISOR
            map.on('load', function () {
                map.addSource("Indice-compacidad-absoluta_source", {
                    type: "vector",
                    url: "mapbox://mapgui113.dqgkom5l"
                });

                map.addLayer({
                    id: "Indice-compacidad-absoluta",
                    type: "fill",
                    source: "Indice-compacidad-absoluta_source",
                    'source-layer': "Indice_de_compacidad_absoluta-6s0cdi",
                    paint: {'fill-color': "#ff5500", 'fill-opacity': 0.50}

                });
            });

            // AQUÍ SE CARGA LA CAPA DE PARQUES AL VISOR
            map.on('load', function () {
                map.addSource("Area-de-Influencia-PARQUES_source", {
                    type: "vector",
                    url: "mapbox://mapgui113.a7a13old"
                });

                map.addLayer({
                    id: "Area-de-Influencia-PARQUES",
                    type: "fill",
                    source: "Area-de-Influencia-PARQUES_source",
                    'source-layer': "Area_de_influencia_PARQUES-cnfa40",
                    paint: {'fill-color': "#aac567", 'fill-opacity': 0.50}
                     
                });
            });

            // AQUÍ SE CARGA LA CAPA DE MOVILIDAD AL VISOR
            map.on('load', function () {
                map.addSource("Area-de-influencia-MOVILIDAD_source", {
                    type: "vector",
                    url: "mapbox://mapgui113.d7gxjfc7"
                });

                map.addLayer({
                    id: "Area-de-influencia-MOVILIDAD",
                    type: "fill",
                    source: "Area-de-influencia-MOVILIDAD_source",
                    'source-layer': "Area_de_influencia_MOVILIDAD-1jnb96",
                    paint: {'fill-color': "#ffd380", 'fill-opacity': 0.50}
                     
                });
            });

            // AQUÍ SE CARGA LA CAPA DE SALUD AL VISOR
            map.on('load', function () {
                map.addSource("Area-de-influencia-SALUD_source", {
                    type: "vector",
                    url: "mapbox://mapgui113.a9zxbcxx"
                });

                map.addLayer({
                    id: "Area-de-influencia-SALUD",
                    type: "fill",
                    source: "Area-de-influencia-SALUD_source",
                    'source-layer': "Area_de_influencia_SALUD-66syph",
                    paint: {'fill-color': "#ffffff", 'fill-opacity': 0.50}
                     
                });
            });

            // AQUÍ SE CARGA LA CAPA DE EDUCACIÓN AL VISOR
            map.on('load', function () {
                map.addSource("Area-de-influencia-EDUCACION_source", {
                    type: "vector",
                    url: "mapbox://mapgui113.0nuqz4qp"
                });

                map.addLayer({
                    id: "Area-de-influencia-EDUCACION",
                    type: "fill",
                    source: "Area-de-influencia-EDUCACION_source",
                    'source-layer': "Area_de_influencia_EDUCACIN-2p16o9",
                    paint: {'fill-color': "#bee8ff", 'fill-opacity': 0.50}
                     
                });
            });
            
            
            // AQUI COMIENZA EL BOTÓN ACTIVAR/DESACTIVAR LA CAPA
            map.on('idle', () => {
                if (!map.getLayer('Usos-de-suelo-residencial-y-multiple') || !map.getLayer('Indice-compacidad-absoluta') || !map.getLayer('Area-de-Influencia-PARQUES')  || 
                    !map.getLayer('Area-de-influencia-MOVILIDAD') || !map.getLayer('Area-de-influencia-SALUD') || !map.getLayer('Area-de-influencia-EDUCACION')) {
                    return;
                }
                const toggleableLayerIds = ['Usos-de-suelo-residencial-y-multiple', 'Indice-compacidad-absoluta', 'Area-de-Influencia-PARQUES', 'Area-de-influencia-MOVILIDAD',
                    'Area-de-influencia-SALUD', 'Area-de-influencia-EDUCACION'];
                for (const id of toggleableLayerIds) {
                    if (document.getElementById(id)) {
                        continue;
                    }

                    const link = document.createElement('a');
                    link.id = id;
                    link.href = '#';
                    link.textContent = id;
                    link.className = 'active';

                    link.onclick = function (e) {
                        const clickedLayer = this.textContent;
                        e.preventDefault();
                        e.stopPropagation();
                        
                        const visibility = map.getLayoutProperty(
                            clickedLayer,
                            'visibility'
                        );

                        if (visibility === 'visible') {
                            map.setLayoutProperty(clickedLayer, 'visibility', 'none');
                            this.className = '';

                        } else {
                            this.className = 'active';
                            map.setLayoutProperty(
                                clickedLayer,
                                'visibility',
                                'visible'
                            );
                        }
                    };
 
                    const layers = document.getElementById('menu');
                    layers.appendChild(link);
                }
            });

        }   
                       
    </script>
</head>

<body onload="init()">
    <div id="map"></div>
</body>

</html>